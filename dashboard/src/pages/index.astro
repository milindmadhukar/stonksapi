---
import "../styles/global.css";
const backendUrl = import.meta.env.PUBLIC_BACKEND_URL || "localhost:8084";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#09090b" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="description" content="Milind's Stonks - Live Financial Dashboard" />
    <meta name="backend-url" content={backendUrl} />
    <title>Milind's Stonks</title>
    <!-- Inline theme script to prevent FOUC -->
    <script is:inline>
      const savedTheme = localStorage.getItem("stonks-theme") || "system";
      if (savedTheme === "dark" || (savedTheme === "system" && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>
  </head>
  <body class="bg-surface-0 text-foreground font-mono min-h-screen antialiased transition-colors duration-300">

    <div class="mx-auto max-w-6xl px-3 py-6 sm:px-6 sm:py-8 lg:px-8">
      <!-- Header -->
      <header class="mb-4 sm:mb-6 flex justify-between items-start mt-2">
        <div>
          <div class="flex items-center gap-3 mb-1">
            <h1 class="text-xl sm:text-2xl font-bold tracking-tight">Milind's Stonks</h1>
            <span class="text-xs text-muted font-normal tracking-wide uppercase">live</span>
          </div>
        </div>
        
        <!-- Theme Switcher -->
        <div class="flex items-center gap-1 rounded-full border border-border bg-surface-1 p-1">
          <button id="theme-light" class="theme-btn rounded-full p-1.5 text-muted transition-colors hover:text-foreground" title="Light Theme">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-2.259-1.591-1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" /></svg>
          </button>
          <button id="theme-dark" class="theme-btn rounded-full p-1.5 text-muted transition-colors hover:text-foreground" title="Dark Theme">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" /></svg>
          </button>
          <button id="theme-system" class="theme-btn rounded-full p-1.5 text-muted transition-colors hover:text-foreground active" title="System Theme">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25" /></svg>
          </button>
        </div>
      </header>

      <!-- Connection status -->
      <div id="status" class="flex items-center gap-2 mb-4 sm:mb-5 text-xs text-muted">
        <span class="status-dot disconnected inline-block h-2 w-2 rounded-full bg-down shadow-[0_0_6px] shadow-down"></span>
        <span>Disconnected</span>
      </div>
      <!-- Tabs -->
      <div class="flex gap-2 sm:gap-4 mb-4 sm:mb-6 border-b border-border/50 overflow-x-auto scrollbar-thin pb-1">
        <button id="tab-all" class="category-tab active px-3 py-2 text-sm font-medium border-b-2 border-accent text-foreground whitespace-nowrap transition-colors">All</button>
        <button id="tab-stocks" class="category-tab px-3 py-2 text-sm font-medium border-b-2 border-transparent text-muted hover:text-foreground whitespace-nowrap transition-colors">Stocks</button>
        <button id="tab-crypto" class="category-tab px-3 py-2 text-sm font-medium border-b-2 border-transparent text-muted hover:text-foreground whitespace-nowrap transition-colors">Crypto</button>
        <button id="tab-indices" class="category-tab px-3 py-2 text-sm font-medium border-b-2 border-transparent text-muted hover:text-foreground whitespace-nowrap transition-colors">Indices</button>
      </div>
      <!-- Subscribe input -->
      <div class="flex gap-2 mb-6 sm:mb-8 max-w-lg">
        <div class="relative flex-1">
          <input
            id="ticker-input"
            type="text"
            placeholder="Search stocks, indices or enter TSLA:NASDAQ, BTC-USD ..."
            autocomplete="off"
            class="w-full rounded-lg border border-border bg-surface-1 px-3 py-2 sm:px-4 sm:py-2.5 text-sm text-foreground placeholder:text-muted/60 outline-none transition-all duration-200 focus:border-accent focus:ring-1 focus:ring-accent/30"
          />
          <!-- Search results dropdown -->
          <div
            id="search-dropdown"
            class="hidden absolute z-50 left-0 right-0 top-full mt-1 rounded-lg border border-border bg-surface-1 shadow-xl shadow-black/30 overflow-hidden max-h-64 overflow-y-auto"
          ></div>
        </div>
        <button
          id="subscribe-btn"
          class="rounded-lg bg-accent px-4 py-2 sm:px-5 sm:py-2.5 text-sm font-medium text-white transition-all duration-200 hover:bg-accent-hover hover:shadow-lg hover:shadow-accent/20 active:scale-[0.97] cursor-pointer whitespace-nowrap"
        >
          Subscribe
        </button>
      </div>

      <!-- Toolbar: filter, sort, view toggle -->
      <div id="toolbar" class="hidden mb-6 flex flex-wrap items-center gap-2 sm:gap-3">
        <!-- Exchange filter -->
        <div class="flex items-center gap-1.5 sm:gap-2">
          <label for="filter-exchange" class="text-xs text-muted">Exchange</label>
          <select
            id="filter-exchange"
            class="rounded-lg border border-border bg-surface-1 px-2 py-1.5 sm:px-3 text-xs text-foreground outline-none transition-colors focus:border-accent cursor-pointer"
          >
            <option value="ALL">All</option>
          </select>
        </div>

        <!-- Sort -->
        <div class="flex items-center gap-1.5 sm:gap-2">
          <label for="sort-select" class="text-xs text-muted">Sort</label>
          <select
            id="sort-select"
            class="rounded-lg border border-border bg-surface-1 px-2 py-1.5 sm:px-3 text-xs text-foreground outline-none transition-colors focus:border-accent cursor-pointer"
          >
            <option value="custom">Custom order</option>
            <option value="winners">Winners</option>
            <option value="losers">Losers</option>
            <option value="marketcap">Market Cap</option>
            <option value="volume">Volume</option>
            <option value="updated">Last Updated</option>
          </select>
        </div>

        <!-- View toggle -->
        <div class="ml-auto flex items-center rounded-lg border border-border bg-surface-1 p-0.5">
          <button
            id="view-card"
            class="view-toggle-btn rounded-md px-2.5 py-1.5 text-xs transition-colors active"
            title="Card view"
          >
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25a2.25 2.25 0 0 1-2.25-2.25v-2.25Z" /></svg>
          </button>
          <button
            id="view-list"
            class="view-toggle-btn rounded-md px-2.5 py-1.5 text-xs transition-colors"
            title="List view"
          >
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>
          </button>
        </div>
      </div>

      <!-- Empty state -->
      <div id="empty-state" class="flex flex-col items-center justify-center py-16 sm:py-20 text-center">
        <div class="rounded-2xl bg-surface-1 border border-border p-6 mb-4">
          <svg class="mx-auto h-10 w-10 text-muted/40" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5m.75-9 3-3 2.148 2.148A12.061 12.061 0 0 1 16.5 7.605" />
          </svg>
        </div>
        <p class="text-sm text-muted mb-1">No tickers subscribed</p>
        <p class="text-xs text-muted/60">Enter a symbol above to start tracking</p>
      </div>

      <!-- Cards grid (card view default) -->
      <div id="cards" class="grid grid-cols-1 gap-3 sm:gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>

      <!-- List view -->
      <div id="list-view" class="hidden">
        <!-- Desktop table header (hidden on mobile) -->
        <div class="hidden sm:block rounded-t-xl border border-b-0 border-border bg-surface-1">
          <div class="list-header grid text-xs text-muted font-medium px-4 py-2.5">
            <span class="text-left">Ticker</span>
            <span class="text-left">Name</span>
            <span class="text-right">Price</span>
            <span class="text-right">Change</span>
            <span class="text-right">Change %</span>
            <span class="text-right hidden lg:block">Volume</span>
            <span class="text-right hidden lg:block">Mkt Cap</span>
            <span class="text-right hidden md:block">Updated</span>
            <span></span>
          </div>
        </div>
        <div id="list-body" class="rounded-xl sm:rounded-t-none border border-border bg-surface-1 divide-y divide-border/50 overflow-hidden"></div>
      </div>
    </div>

    <script src="../scripts/dashboard.ts"></script>
  </body>
</html>
